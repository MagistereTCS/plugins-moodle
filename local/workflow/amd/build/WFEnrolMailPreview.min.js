define(["jquery","core/notification","jqueryui","local_workflow/jquery.loadingModal"],function(a,b){function c(c){a("#wf_dialog_preview_mails").dialog({autoOpen:!1,width:700,height:"auto",maxHeight:470,title:"PrÃ©visualisation de l'inscription mail",draggable:"false",modal:!0,resizable:!1,closeOnEscape:!1,closeText:"Fermer",buttons:[{text:"Valider",id:"btValidateMails",click:function(){a("#mform1").length&&a("#mform1").submit()}},{text:"Annuler",id:"btCancel",click:function(){a(this).dialog("close")}}]}),a("#id_submitgeneral").click(function(){var d=[],e=[],f=[],g=[],h=[],i=[],j=[];a("div[id^=fitem_id_][id$=_groups_user_enrol]").map(function(b,c){var d=[];a(c).find("select").find(":selected").map(function(b,c){d.push(a(c).text())}),h.push(d.join())}),a("div[id^=fitem_id_][id$=_userfile]").map(function(b,c){var f=/fitem_id_(.*)_userfile/g,g=f.exec(a(c).attr("id")),j=g[1];a(c).find(".filepicker-filename").find("a").map(function(c,f){d.push(a(f).attr("href")),e.push(j),i.push(h[b])})}),a("div[id^=fitem_id_][id$=_email_user_enrol]").map(function(b,c){var d=/fitem_id_(.*)_email_user_enrol/g,e=d.exec(a(c).attr("id")),i=e[1];a(c).find("textarea").filter(function(b,c){return""!=a(c).val()}).map(function(c,d){f.push(a(d).val()),g.push(i),j.push(h[b])})}),d&&d.length>0||f&&f.length>0?(a("body").loadingModal({position:"auto",text:"Validation des emails en cours...",color:"#fff",opacity:"0.7",backgroundColor:"rgb(0,0,0)",animation:"circle"}),a.post(c,{urls:d,files_role:e,manual_emails:f,manual_emails_role:g,csv_groups_lists:i,manual_groups_lists:j},function(c){if("false"==c.error)b.alert("Erreur","Erreur de communication avec le serveur.","Retour");else{var d=c;a("#wf_dialog_preview_mails").html(d),a("#wf_dialog_preview_mails").show(),a("#wf_dialog_preview_mails").dialog("open")}a("body").loadingModal("destroy")},"html")):a("#mform1").length&&a("#mform1").submit()})}return{init:function(a){c(a)}}});